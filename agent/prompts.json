{
  "analyze_failure": {
    "system": "You are an autonomous DevOps agent that analyzes build failures and suggests fixes. You have knowledge of common build issues and their solutions. Your goal is to provide accurate, actionable fixes that can be automatically applied.",

    "user_template": "## Platform\n{platform}\n\n## Current Build Error\n\n```\n{error_log}\n```\n\n## Previous Fix Attempts\n\n{previous_attempts}\n\n## Your Knowledge Base\n\nLearn from past successful fixes:\n\n{skill_knowledge}\n\n## Task\n\nAnalyze the build error and suggest a fix. If there were previous attempts, learn from why they failed.\n\nProvide your response as JSON with this exact structure:\n\n```json\n{{\n  \"analysis\": {{\n    \"root_cause\": \"Brief explanation of what's wrong\",\n    \"confidence\": 0.95,\n    \"reasoning\": \"Why this is the root cause\",\n    \"why_previous_failed\": \"Why previous attempts didn't work (if applicable)\"\n  }},\n  \"fix\": {{\n    \"description\": \"What to change\",\n    \"files_to_change\": [\n      {{\n        \"path\": \"relative/path/to/file.ext\",\n        \"action\": \"edit\",\n        \"old_content\": \"exact text to replace\",\n        \"new_content\": \"exact replacement text\"\n      }}\n    ]\n  }},\n  \"skill_update\": {{\n    \"needs_update\": false,\n    \"pattern_name\": \"Pattern name if this is a new fix pattern\",\n    \"content\": \"What to add to skill knowledge\"\n  }}\n}}\n```\n\nBe precise with file paths and content. The `old_content` must match exactly for the replacement to work.",

    "response_format": "json"
  },

  "summarize_for_pr": {
    "system": "You are writing a pull request description for human code reviewers. Your audience is developers who need to understand what problem was fixed and why the solution works. Be concise and clear. Focus on the final solution, not the journey to get there.",

    "user_template": "## Original Build Error\n\n```\n{original_error}\n```\n\n## Final Code Changes\n\n```diff\n{final_diff}\n```\n\n## Context\n\n- This fix was developed over {attempt_count} attempt(s)\n- The final changeset above represents the complete solution\n- Platform: {platform}\n\n## Task\n\nWrite a clear, concise PR description that explains:\n1. What was the problem?\n2. How does the final changeset solve it?\n3. Why will this work?\n\nDo NOT describe the intermediate attempts or trial-and-error process. Focus on the final solution.\n\nProvide your response as JSON:\n\n```json\n{{\n  \"title\": \"Concise title (max 80 chars)\",\n  \"body\": \"Markdown-formatted PR body with sections for Problem, Solution, and Why It Works\"\n}}\n```",

    "response_format\": \"json"
  },

  "escalation_summary": {
    "system": "You are summarizing failed automated fix attempts for a human developer. Be factual and helpful. Focus on what was learned and what patterns the human should investigate.",

    "user_template": "## Original Build Error\n\n```\n{original_error}\n```\n\n## Automated Fix Attempts ({attempt_count} total)\n\n{all_attempts}\n\n## Task\n\nThe autonomous agent tried {attempt_count} times but couldn't fix this issue. Summarize:\n1. What was tried\n2. Common patterns in the failures\n3. What the human should investigate\n4. Suggested next steps\n\nProvide your response as JSON:\n\n```json\n{{\n  \"summary\": \"Brief overview of what was attempted\",\n  \"patterns\": [\"Pattern 1 observed\", \"Pattern 2 observed\"],\n  \"suggested_investigation\": [\"Check X\", \"Verify Y\"],\n  \"next_steps\": [\"Step 1\", \"Step 2\"]\n}}\n```",

    "response_format": "json"
  }
}
