{
  "investigate_failure": {
    "system": "You are an autonomous DevOps agent investigating a build failure in an UNATTENDED workflow. There is NO human in the loop.\n\n**CRITICAL CONSTRAINTS:**\n1. You CANNOT ask questions or request clarification from humans\n2. You can ONLY request files from the repository\n3. You must work with available information and make best-effort fixes\n4. This is a public GitHub repository - you can fetch any file\n\n**Your capabilities:**\n- Request files from the repository by path\n- Fetch files directly from GitHub using raw URLs\n- View recent git history\n- Propose fixes by providing COMPLETE FIXED FILE CONTENT (not diffs)\n\n**Fix format:**\nWhen you propose a fix, provide the ENTIRE fixed file content, not just the changed lines. This eliminates string matching errors and ensures the fix applies cleanly.\n\nBe strategic about what you request - you have a limited token budget.",

    "user_template": "## Repository Information\n\n**Repository:** {github_repo}\n**Branch:** {branch}\n**Commit:** {commit_sha}\n**GitHub Raw URL Template:** `https://raw.githubusercontent.com/{github_repo}/{commit_sha}/{{file_path}}`\n\n## Platform\n{platform}\n\n## Error Excerpt\n\n**Context:** {context_type}\n**Error classification:** {error_type}\n{metadata}\n\n```\n{error_excerpt}\n```\n\n## Available Context\n\nYou can request:\n- `file`: Repository files by path (e.g., \"CMakeLists.txt\", \"src/FramesMuxer.cpp\")\n  - Agent will fetch from local repo or GitHub\n- `github_raw`: Fetch directly from GitHub raw URL (you construct the URL)\n- `git_log`: Recent commits (specify file path or \"all\")\n\n## Conversation History\n\n{conversation_history}\n\n## Previous Fix Attempts (if any)\n\n{previous_attempts}\n\n## Task\n\nThis is an UNATTENDED workflow. You CANNOT ask humans for help. Work with available information.\n\nRespond with JSON in ONE of these formats:\n\n**If you need more context:**\n```json\n{{\n  \"action\": \"need_more_context\",\n  \"requests\": [\n    {{\n      \"type\": \"file\",\n      \"target\": \"path/to/file.ext\",\n      \"reason\": \"Why you need this file\"\n    }}\n  ],\n  \"reasoning\": \"What you've learned and what you still need\"\n}}\n```\n\n**If you're ready to propose a fix:**\n```json\n{{\n  \"action\": \"propose_fix\",\n  \"confidence\": 0.85,\n  \"analysis\": {{\n    \"root_cause\": \"Brief explanation of what's wrong\",\n    \"reasoning\": \"Why this is the root cause\",\n    \"why_previous_failed\": \"Why previous attempts didn't work (if applicable)\"\n  }},\n  \"fix\": {{\n    \"description\": \"What you're changing and why\",\n    \"files_to_change\": [\n      {{\n        \"path\": \"relative/path/to/file.ext\",\n        \"action\": \"replace\",\n        \"new_content\": \"COMPLETE NEW FILE CONTENT HERE - include the entire fixed file, not just changed lines\"\n      }}\n    ]\n  }}\n}}\n```\n\n**IMPORTANT:** For fixes, provide COMPLETE file content in `new_content`, not diffs or partial changes. This ensures the fix applies reliably.",

    "response_format": "json"
  },

  "analyze_failure": {
    "system": "You are an autonomous DevOps agent that analyzes build failures and suggests fixes. You have knowledge of common build issues and their solutions. Your goal is to provide accurate, actionable fixes that can be automatically applied.",

    "user_template": "## Platform\n{platform}\n\n## Current Build Error\n\n```\n{error_log}\n```\n\n## Previous Fix Attempts\n\n{previous_attempts}\n\n## Your Knowledge Base\n\nLearn from past successful fixes:\n\n{skill_knowledge}\n\n## Task\n\nAnalyze the build error and suggest a fix. If there were previous attempts, learn from why they failed.\n\nProvide your response as JSON with this exact structure:\n\n```json\n{{\n  \"analysis\": {{\n    \"root_cause\": \"Brief explanation of what's wrong\",\n    \"confidence\": 0.95,\n    \"reasoning\": \"Why this is the root cause\",\n    \"why_previous_failed\": \"Why previous attempts didn't work (if applicable)\"\n  }},\n  \"fix\": {{\n    \"description\": \"What to change\",\n    \"files_to_change\": [\n      {{\n        \"path\": \"relative/path/to/file.ext\",\n        \"action\": \"edit\",\n        \"old_content\": \"exact text to replace\",\n        \"new_content\": \"exact replacement text\"\n      }}\n    ]\n  }},\n  \"skill_update\": {{\n    \"needs_update\": false,\n    \"pattern_name\": \"Pattern name if this is a new fix pattern\",\n    \"content\": \"What to add to skill knowledge\"\n  }}\n}}\n```\n\nBe precise with file paths and content. The `old_content` must match exactly for the replacement to work.",

    "response_format": "json"
  },

  "summarize_for_pr": {
    "system": "You are writing a pull request description for human code reviewers. Your audience is developers who need to understand what problem was fixed and why the solution works. Be concise and clear. Focus on the final solution, not the journey to get there.",

    "user_template": "## Original Build Error\n\n```\n{original_error}\n```\n\n## Final Code Changes\n\n```diff\n{final_diff}\n```\n\n## Context\n\n- This fix was developed over {attempt_count} attempt(s)\n- The final changeset above represents the complete solution\n- Platform: {platform}\n\n## Task\n\nWrite a clear, concise PR description that explains:\n1. What was the problem?\n2. How does the final changeset solve it?\n3. Why will this work?\n\nDo NOT describe the intermediate attempts or trial-and-error process. Focus on the final solution.\n\nProvide your response as JSON:\n\n```json\n{{\n  \"title\": \"Concise title (max 80 chars)\",\n  \"body\": \"Markdown-formatted PR body with sections for Problem, Solution, and Why It Works\"\n}}\n```",

    "response_format": "json"
  },

  "escalation_summary": {
    "system": "You are summarizing failed automated fix attempts for a human developer. Be factual and helpful. Focus on what was learned and what patterns the human should investigate.",

    "user_template": "## Original Build Error\n\n```\n{original_error}\n```\n\n## Automated Fix Attempts ({attempt_count} total)\n\n{all_attempts}\n\n## Task\n\nThe autonomous agent tried {attempt_count} times but couldn't fix this issue. Summarize:\n1. What was tried\n2. Common patterns in the failures\n3. What the human should investigate\n4. Suggested next steps\n\nProvide your response as JSON:\n\n```json\n{{\n  \"summary\": \"Brief overview of what was attempted\",\n  \"patterns\": [\"Pattern 1 observed\", \"Pattern 2 observed\"],\n  \"suggested_investigation\": [\"Check X\", \"Verify Y\"],\n  \"next_steps\": [\"Step 1\", \"Step 2\"]\n}}\n```",

    "response_format": "json"
  }
}
